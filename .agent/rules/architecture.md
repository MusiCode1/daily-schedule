---
description: הנחיות לארכיטקטורה
trigger: always_on
alwaysApply: true
---

# חוקי ארכיטקטורה וארגון קוד

## 🏗️ ארכיטקטורה: 3 השכבות (The 3-Layer Architecture)

המערכת בנויה ב-3 שכבות ברורות להפרדת רשויות:

### 1. שכבת המידע (Data Layer) - `src/lib/stores`

- **אחריות**: ניהול נתונים גולמיים, שמירה (Persistence) ומיגרציות.
- **רכיבים**: Stores מפוצלים לפי ישות (`userStore`, `listStore`).
- **כלל**: שכבה זו "עיוורת" לתצוגה. אין בה לוגיקה של UI (כגון "האם המודאל פתוח").

### 2. שכבת הלוגיקה (Logic Layer) - `src/lib/logic`

- **אחריות**: תיווך בין ה-UI לנתונים, וניהול מצב התצוגה (UI State).
- **מבנה**: מחלקות **Controller** המחולקות לפי **נושא** (Topic-Based), לא לפי דף.
  - דוגמה: `TasksBoardController` (מנהל משימות וחגיגות), `ListsNavigationController` (מנהל רשימות).
- **כלל**: הקונטרולר חושף לממשק את הנתונים (דרך getters) ואת הפעולות (Actions).

### 3. שכבת התצוגה (View Layer) - `src/routes`, `src/lib/components`

- **אחריות**: הצגת המידע וקליטת אירועים ממשתמש.
- **כלל**: קומפוננטות "טיפשות". הן יוצרות מופע של הקונטרולר ומשתמשות בו, ללא לוגיקה עסקית ב-`<script>`.

## 🎯 ריכוז נתונים (Centralization & Single Source of Truth)

- **מקור אמת יחיד לנתונים**: קובץ `src/lib/data/defaults.ts` הוא המקום הבלעדי להגדרת נתוני ברירת מחדל (רשימות, פעילויות). אין להחזיק קבצי JSON כפולים או נתונים מבוזרים בקוד.
- **שירות שפה מרכזי**: קובץ `src/lib/services/language.ts` מרכז את כל הטקסטים במערכת (מחרוזות UI, הודעות, ברכות). אין לכתוב טקסטים קשיחים (Hardcoded) בקומפוננטות.
- **מיגרציות מאוחדות**: כל לוגיקת המיגרציה נמצאת ב-`src/lib/services/migration.ts`. קבצי ה-Persistence רק קוראים לשירות זה.

## 📝 מוסכמות קוד

- **Runes**: שימוש במערכת ה-Reactivity של Svelte 5 (`$state`, `$derived`) בתוך הקונטרולרים.
- **Stores**: פיצול לרכיבים קטנים (`userStore`, `listStore`) במקום Store מונוליטי.
