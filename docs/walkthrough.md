# יומן פיתוח (Walkthrough)

## 2026-01-14 02:00

### סנכרון ופתרון קונפליקטים (Google Drive)

### שינויים שבוצעו

- **ניהול גרסאות נתונים (`lastModified`)**:

  - הוספת שדה `lastModified` ל-`AppState` ולכל הממשקים הרלוונטיים.
  - עדכון `persistence.ts` לעדכון החותמת בכל שמירה.
  - עדכון מיגרציות ונתוני ברירת מחדל (`defaults.ts`) לתמיכה בשדה החדש.

- **זיהוי קונפליקטים (`BackupController`)**:

  - פיתוח לוגיקה המשווה את חותמת הזמן של הגיבוי בענן מול המידע המקומי בעת התחברות.
  - זיהוי "גיבוי חדש יותר" (Remote Newer) בפער של מעל 5 שניות.

- **ממשק פתרון קונפליקטים**:

  - שדרוג `GoogleDriveBackup.svelte` עם מודאל אזהרה ייעודי.
  - הצגת השוואה ברורה בין הגרסה המקומית לגרסת הענן (תאריך ושעה).
  - כפתורי בחירה: "עדכן מהענן" (Discards Local) או "השאר מקומי" (Overwrites Cloud next backup).

- **לוקליזציה**:
  - הוספת מחרוזות בעברית לכל תרחישי הקונפליקט ב-`language.ts`.

### הערות טכניות

- המנגנון מונע דריסה דורסנית של מידע במקרה שבו משתמש עובד במקביל (או שכח את האפליקציה פתוחה) במכשיר אחר.

## 2026-01-14 01:50

### גיבוי וסנכרון לגוגל דרייב (ללא שרת)

### שינויים שבוצעו

- **שירות ליבה (`googleDriveService`)**:

  - פיתוח מעטפת (Wrapper) מודרנית ל-Google Identity Services (GIS) ול-Drive API v3.
  - תמיכה מלאה בתהליך OAuth2 בצד הלקוח (Implicit Flow), כולל טיפול בטעינת סקריפטים.
  - פונקציות לגיבוי (Create/Update), שחזור (Get media), ורשימת קבצים.

- **בקר לוגי (`BackupController`)**:

  - ניהול לוגיקת הגיבוי האוטומטי: מאזין לשינויים ב-Store ומבצע גיבוי לאחר השהייה (Debounce) של 5 שניות.
  - ניהול State: מחובר/מנותק, זמן גיבוי אחרון, פרטי משתמש.
  - תמיכה ב-Client ID מותאם אישית דרך ממשק ההגדרות.

- **ממשק משתמש (`GoogleDriveBackup`)**:

  - רכיב חדש בהגדרות המציג את סטטוס החיבור, תמונת המשתמש, וכפתורי פעולה.
  - אפשרות לגיבוי ידני מיידי.
  - מודאל בחירת קובץ לשחזור (במקרה של מעבר מכשיר).

- **אינטגרציה ל-Store**:
  - עדכון `globalState` כך שבכל פעולת שמירה (`save`), נשלחת הודעה לבקר הגיבוי.

### שיפורים ותיקונים (v2)

- **שמירה בתיקייה**: הגיבוי נשמר כעת בתיקייה ייעודית `DailyScheduleBackup` בדרייב, לשמירה על סדר.
- **גיבוי תמונות**: המערכת שולפת תמונות מ-IndexedDB ומטמיעה אותן בקובץ הגיבוי, כך שמעבר מכשיר יעביר גם את התמונות.
- **יציבות חיבור**: נוסף מנגנון שמירת טוקן (Persistence) ב-LocalStorage למניעת ניתוק ברענון הדף, כולל סנכרון מול `gapi`.
- **תיקוני טעינת תמונות**: שימוש בפעולה `use:dbImage` בכל הרכיבים (`CelebrationModal`, `ListSwitcher`) כדי לתמוך בקישורי `idb:`.
- **Typings**: הוספת הגדרות TypeScript לספריות של Google (`@types/gapi`).

### הערות טכניות

- היישום הוא **Serverless** לחלוטין. האימות מתבצע ישירות מול גוגל.
- המידע נשמר כקובץ JSON המכיל את כל הנתונים והתמונות (Base64).

---

## 2026-01-14 01:48

### מיתוג (לוגו) ושיפור דף הכניסה

### שינויים שבוצעו

- **עיצוב גרפי (לוגו)**:

  - עוצב לוגו חדש בפורמט SVG (`src/lib/assets/logo.svg`) תחת הקונספט "סדר יום מובנה". הלוגו מציג 3 כרטיסיות מדורגות, המייצגות רצף וסדר, עם צבעוניות של "צי מלוכה" (Navy) ו"קורל" (Coral) ליצירת מראה מקצועי, נקי אך חם.
  - הלוגו הוגדר גם כ-favicon של האתר.

- **דף כניסה (UserSelector)**:

  - שדרוג העיצוב: הלוגו מופיע כעת לצד שם האפליקציה ("סדר יום ויזואלי") בכותרת העליונה.
  - שיפור היררכיה: הפרדה ברורה בין המיתוג (Header) לבין ההנחיה למשתמש ("מי משתמש בלוח היום?").

- **מטא-דאטה**:
  - שם האפליקציה עודכן רשמית ב-`language.ts` ל-"סדר יום ויזואלי".

---

## 2026-01-14 01:36

### ליטוש חוויית חגיגה ומשוב קולי

### שינויים שבוצעו

- **ממשק חגיגה (Celebration Modal)**:

  - שדרוג `CelebrationModal.svelte` לתמיכה במצבי "משימה" ו"כללי".
  - המודאל כעת מציג באופן ויזואלי את המשימה שהושלמה, מחמאה מודגשת, ואת המשימה הבאה בתור (עם תצוגה מקדימה).
  - אינטגרציה מלאה עם נתוני המשתמש (שם, תמונה) והמגדר.

- **לוגיקת משוב (Feedback Logic)**:

  - עדכון `tasksBoard.svelte.ts` לשימוש ב-`boostService` וב-`audioSequencer`.
  - הוספת המתנה (`await`) לסיום ניגון רצף האודיו המלא לפני סגירה אוטומטית של המודאל.
  - טיפול במקרי קצה: סיום כל המשימות, או חגיגה כללית (גיבוי/פעולה אחרת) ללא הקשר משימה.

- **תוכן ומשאבים**:
  - עדכון `defaults.ts` ו-`language.ts` עם נתונים התומכים בלוגיקה החדשה.
  - הכנה לתמיכה בגיבוי בענן (הוספת תשתית בקבצי הליבה).

### בדיקות

- וידוא סנכרון בין האודיו (TTS/קבצים) לבין הופעת המודאל.
- בדיקת זרימה של השלמת משימה -> חגיגה -> סגירה.

---

## 2026-01-14 01:25

### הפרדת דף בחירת משתמש ושיפור טעינה

### שינויים שבוצעו

- **ארכיטקטורה וניווט**:

  - **הפרדת נתיב**: מסך בחירת המשתמש (`UserSelector`) הועבר משילוב בדף הבית לנתיב ייעודי ועצמאי: `/login`.
  - **ניהול הפניות**: הדף הראשי (`/`) כעת בודק את סטטוס הטעינה והחיבור. משתמש לא מחובר מופנה ל-`/login` (לאחר טעינה), ומשתמש מחובר נשאר בלוח.

- **חוויית טעינה (UX)**:

  - **Splash Screen**: יצירת רכיב `src/lib/components/SplashScreen.svelte` המציג אנימציית טעינה נקייה וממותגת. רכיב זה מוצג בזמן שהאפליקציה מבצעת "Hydration" וטוענת נתונים, כדי למנוע הבהובים של תוכן לא רלוונטי ("Flash of Unstyled Content" או תצוגת לוגין רגעית).

- **קוד**:
  - `src/routes/+page.svelte`: הוספת מנגנון `isLoaded` המבוסס על `onMount` (לווידוא ריצה בצד הלקוח) ושימוש ב-`$effect` לביצוע הפניות ניווט ריאקטיביות. ההפניה האוטומטית מ-`/login` בוטלה לפי בקשת המשתמש.
  - `src/routes/login/+page.svelte`: דף חדש המארח את `UserSelector` ומטפל בכניסה למערכת.

### בדיקות ואימות

- **בדיקת דפדפן (סוכן אוטונומי)**:
  - בוצעה סימולציה של משתמש חדש (ניקוי `localStorage`).
  - וידוא שהגעה ל-`/` מפנה ל-`/login` (עם הצגת Splash Screen בדרך).
  - וידוא שבחירת משתמש ב-`/login` מפנה חזרה ל-`/` ומציגה את הלוח האישי.
  - צילומי מסך בוצעו לאימות ויזואלי של דף הלוגין ודף הבית לאחר כניסה.

---

## 2026-01-13: משוב קולי היברידי (TTS + קבצים)

### שינויים שבוצעו

- **שירותי אודיו**:
  - `src/lib/services/audioSequencer.ts`: שירות חדש לניגון רצף של מקטעי אודיו (קבצים ו-TTS משולבים).
  - `src/lib/services/boosts.ts`: עדכון `getFeedbackSequence` ליצירת רצף דינמי ("סיימת את [משימה]! [חיזוק]! עכשיו, [הבא בתור]"). שימוש בלוגיקה היברידית המעדיפה קבצי MP3 אם קיימים, ונופלת ל-TTS אם לא.
- **נתונים**:
  - הוספת קבצי קריינות חדשים (`static/sounds`) עבור חלקי המשפט המקשרים ("סיימת את...", "עכשיו...", "כל הכבוד").
- **UI**:
  - `+page.svelte`: אינטגרציה עם ה-Sequencer בעת סיום משימה, והארכת זמן הצגת הפופאפ ל-5 שניות.
- **תרגום הערות קוד**:
  - כל הערות הקוד (Comments) בפרויקט תורגמו מאנגלית לעברית, כולל Stores, Services, Logic, Components ו-Routes.

### בדיקות

- **קבצים**: וידוא שקבצים קיימים (`shower.mp3`) מתנגנים כחלק מהרצף.
- **TTS**: וידוא שמשימות ללא קבצים מוקראות ע"י הדפדפן.
- **רצף**: בדיקת המעברים בין חלקי המשפט.

## 2026-01-13: סנכרון פופ-אפ חגיגה ומבנה מודולרי

### שינויים שבוצעו

- **סנכרון ויזואלי-קולי**:
  - `TasksBoardController`: עודכן להמתין (`await`) לסיום רצף האודיו המלא לפני סגירת פופ-אפ החגיגה.
- **עיצוב מודולרי**:
  - `CelebrationModal.svelte`: המודאל הפך למובנה ומציג:
    1. כותרת "סיימת את [שם המשימה]"
    2. תמונת המשימה (בגדול)
    3. מחמאה (בטקסט בולט)
    4. "עכשיו, [שם המשימה הבאה]" + תמונה קטנה של המשימה הבאה.
  - `language.ts`: הפרדת הטקסטים והלוגיקה כדי להחזיר את המחמאה (`praise`) בנפרד לצורך תצוגה ויזואלית מודגשת.
- **תשתית נתונים**:
  - הגדרת `CelebrationData` המכיל את כל המידע הדרוש לתצוגה (תמונות, טקסטים, מגדר), מה שמונע תלות בלוגיקה בתוך הקומפוננטה.

### בדיקות

- **זרימה**: ברגע סיום משימה, הפופ-אפ נפתח, מציג את תמונת המשימה הנוכחית והבאה, והאודיו מתנגן בסנכרון.
- **סגירה**: הפופ-אפ נסגר אוטומטית _רק_ לאחר סיום הקריינות.
- **מקרי קצה**: טיפול במצב שבו אין משימה עוקבת (סיום יום).

---

## 2026-01-12: יישום אחסון תמונות ב-IndexedDB

### שינויים שבוצעו

- **שירותי אחסון**:
  - `src/lib/services/db.ts`: מעטפת ל-IndexedDB לשמירת Blob.
  - `src/lib/services/migration.ts`: מיגרציה אוטומטית מתמונות Base64 ל-IDB.
- **לוגיקת UI**:
  - `src/lib/actions/dbImage.ts`: פעולת Svelte לטעינה אסינכרונית של תמונות (Data URL -> Blob URL).
- **רכיבים**:
  - `AddModal.svelte`: שומר תמונות ל-DB מיידית בעת הבחירה.
  - `TaskRow.svelte`: משתמש ב-`dbImage` להצגת התמונות.
  - `appStore.svelte.ts`: מפעיל את המיגרציה בעת הטעינה.

### בדיקות ואימות

בוצע אימות ויזואלי באמצעות סריקת דפדפן אוטומטית:

1.  **הוספת תמונה מותאמת אישית (משימות, משתמשים, רשימות)**: סימולציה של העלאת קובץ עברה בהצלחה.
2.  **רכיב גנרי (`ImageUploader`)**: הוטמע בהצלחה ומשמש אחידות בכל המערכת.
3.  **בורר משתמשים**: מציג בהצלחה תמונות מפרופיל המשתמש ב-IndexedDB.

#### תיעוד ויזואלי

![מודל הוספה עם תצוגה מקדימה](add_task_modal_with_upload_preview_1768209965594.png)
![ניהול משתמשים - Avatar](verification_users_tab_1768210807339.png)
![ניהול רשימות - לוגו](verification_lists_tab_1768210817481.png)
![בורר משתמשים ראשי](verification_user_selector_1768210845352.png)
ושינויים

מסמך זה מתעד את התקדמות הפיתוח, שינויים מהותיים ומימושי פיצ'רים.

> [!NOTE]
> 2026-01-06 23:59

## שיפורים ויזואליים בממשק הניהול

שדרוג משמעותי של דף ההגדרות (`/settings`) לרמת גימור גבוהה ומודרנית.

### מה בוצע?

**1. עיצוב וממשק (UI/UX)**

- **עיצוב מעודכן**: הטמעת סגנון נקי ומודרני (Clean Look) עם שימוש בצלליות רכות (Shadows), פינות עגולות (Rounded Corners) וטיפוגרפיה ברורה.
- **אייקונים**: החלפת כפתורי הטקסט המיושנים (✎/🗑️) באייקוני SVG אינטואיטיביים ונגישים.
- **Grid Layout**: שימוש ב-CSS Grid לסידור רספונסיבי של כרטיסי המשתמשים והרשימות.

**2. שיפורים בטפסים (Forms)**

- **תצוגה מקדימה**: שיפור חווית הוספת משתמש ע"י הצגה ברורה של האווטאר הנבחר בתוך המודאל.
- **פוקוס**: הוספת אינדיקציה ויזואלית ברורה (Focus Ring) בעת מעבר בין שדות.

### החלטות ארכיטקטורה

- **[Vanilla CSS]**: המשכנו להשתמש ב-CSS רגיל בתוך רכיבי Svelte (`<style>`) כדי לשמור על פשטות ולא להוסיף תלות בספריות חיצוניות (כמו Tailwind) בשלב זה, אך השתמשנו במשתנים ודרכים מודרניות לכתיבה כדי להקל על תחזוקה עתידית.

---

> [!NOTE]
> 2026-01-06 21:40

## שיפורי הידר וברכות דינמיות

שיפור נראות ממשק ההידר והטמעת ברכות דינמיות המותאמות לרשימה הפעילה.

### מה בוצע?

**1. שיפורי ממשק (UI Improvements)**

- **אווטאר**: הוגדל מ-40px ל-56px. נוסף אפקט זום (Scale 2.2) במעבר עכבר לשיפור הראות וזיהוי המשתמש.
- **ניקיון**: הוסר הטקסט המיותר של שם המשתמש מתחת לאווטאר.

**2. מנגנון ברכות (Dynamic Greetings)**

- **ברכה מותאמת**: הטקסט ("בוקר טוב" / "אחרי צהריים טובים") נגזר כעת מהגדרת הרשימה הפעילה (`list.greeting`) ולא מקוד קשיח.
- **תמיכה בנתונים**: הוספת שדה `greeting` לממשק `List` ועדכון נתונים קיימים (Migration versions 4, 5) עם ערכי ברירת מחדל ("בהצלחה", "בוקר טוב").

**3. מיגרציה וריפקטור (Refactoring)**

- **migrateState**: הפרדת לוגיקת שדרוג הנתונים לפונקציה נפרדת ב-`appStore` כדי לשמור על `load()` נקי וקריא.

### החלטות ארכיטקטורה

- **[Dynamic Greeting Property]**: בחרנו לשמור את הברכה כמאפיין של הרשימה (`list.greeting`) ולא כחישוב לוגי (Computed). זה יאפשר בעתיד למשתמשים לערוך את הברכה לכל רשימה (למשל: "חופשה נעימה!" לרשימת חופש).

---

> [!NOTE]
> 2026-01-06 20:30

## יצירת אווטארים וארגון נכסים

הושלמה יצירת אווטארים אישיים בסגנון Pixar לכל הילדים ובוצע ארגון מחדש של הנכסים הסטטיים בפרויקט לתחזוקה קלה יותר.

### מה בוצע?

**1. יצירת אווטארים (Avatar Generation)**

- יצירת אווטארים לחברי המשפחה (תמר, יהונתן, אריאל) בתהליך דו-שלבי:
  1.  **Studio Portrait**: יצירת תמונת מקור ריאליסטית "נקייה" בסטודיו עם רקע לבן.
  2.  **Pixar Style**: המרה לדמות תלת-ממד בסגנון Pixar המבוססת על תמונת הסטודיו.
- האווטארים החדשים שולבו באפליקציה ב-`defaults.ts`.

**2. ארגון משאבים (Assets Reorganization)**

- **הפרדת סביבות**: יצירת תיקיית `resources_playground` (מחוץ ל-`static`) עבור חומרי גלם, ניסיונות גנרטיביים וקבצי מקור כבדים.
- **מבנה Static חדש**:
  - `static/images/activities/`: תמונות לפעילויות.
  - `static/images/times/`: אייקונים של זמני היום (בוקר/ערב).
  - `static/images/users/`: האווטארים הסופיים.
  - `static/sounds/ui/`: צלילי ממשק.
- **עדכון קוד**: עדכנו את כל הנתיבים בקוד (`defaults.ts`, `appStore.svelte.ts`, `AddModal.svelte` וכו') לעבודה עם המבנה החדש.

### החלטות ארכיטקטורה

- **[Playground Folder]**: בחרנו להוציא את ה-Raw Files מתוך `static` (ולמעשה מחוץ ל-Build של האפליקציה) כדי לא להכביד על ה-Deploy וכדי לשמור על הפרדה ברורה בין "חומרי עבודה" לבין "נכסי ייצור".

---

> [!NOTE]
> 2026-01-06 15:00

## תמיכה בריבוי משתמשים ושינויים מבניים

הוטמעה תמיכה מלאה בריבוי משתמשים ולוגיקת הליבה עברה לשירותים ייעודיים.

### מה בוצע?

**1. ריבוי משתמשים (User Management)**

- **מסך כניסה (UserSelector)**: יצירת מסך לבחירת המשתמש (תמר, יונתן, אריאל) עם תמיכה באווטארים.
- **התאמה אישית**: תמיכה במין (בן/בת) לברכות מותאמות ("אתה אלוף" / "את אלופה").
- **ניהול State**: יצירת `appStore.svelte.ts` - Store מרכזי המבוסס על Svelte 5 Runes לניהול כל המידע.
- **מיגרציה**: הוספת מנגנון המרה אוטומטי מנתונים ישנים (`my_lists`) למבנה החדש והמאוחד (`daily-schedule-data`).

**2. ריפקטורינג וניקיון קוד (Refactoring)**

- **הוצאת לוגיקה**: פיצול הלוגיקה המורכבת מ-`+page.svelte` לקבצים ייעודיים:
  - `src/lib/services/audio.ts`: ניהול השמעת סאונד.
  - `src/lib/logic/dragDrop.svelte.ts`: ניהול גרירה ושחרור (Drag & Drop) באמצעות מחלקה ייעודית.
- **ניהול נתונים (Data)**: הסרת התלות בקבצי JSON והעברת נתוני ברירת המחדל לקובץ טייפסקריפט `src/lib/data/defaults.ts`.

### החלטות ארכיטקטורה

- **[Unified LocalStorage]**: בחרנו לשמור את כל המידע (משתמשים, רשימות, הגדרות) באובייקט JSON יחיד בלוקל-סטורג'. הסיבה: פשטות בניהול גרסאות, גיבוי ושחזור, ומניעת חוסר תאימות בין מפתחות שונים.
- **[Composables / Runes Classes]**: בחרנו להוציא את לוגיקת ה-Drag&Drop למחלקה (`new DragDropManager`) שמקבלת Getters למצב העדכני. זה מאפשר לקוד הלוגי להישאר נקי מה-UI אך עדיין להגיב לשינויים ב-State (כמו `isEditMode`).

---

## [קודם] מיגרציה ל-Svelte 5 ולוקליזציה

(ראה למטה לשינויים היסטוריים...)
