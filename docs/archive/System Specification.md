# **מפרט מערכת מלא: סדר יום ויזואלי (Visual Schedule)**

## **חלק א': אפיון פונקציונלי (Functional Specification)**

**מיועד עבור:** מנהלי מוצר, מעצבים, ולקוחות.

### **1\. מטרת המערכת**

כלי לניהול סדר יום ויזואלי עבור אנשים על הרצף האוטיסטי. המערכת מייצרת ודאות, סדר, וחיזוקים חיוביים, ומאפשרת ניהול של מספר שגרות יום שונות.

### **2\. תהליכי עבודה (User Flows)**

* **המלווה (מורה/הורה):** יוצר שגרות שונות (למשל "בוקר", "ערב"), שומר אותן, וטוען את השגרה הרלוונטית לזמן הנוכחי.  
* **המשתמש (תלמיד):** צופה ברצף הפעיל של אותה שגרה שנבחרה עבורו.

### **3\. דרישות ממשק (UI) והתנהגות**

#### **א. ניהול שגרות (Schedules Management) \- חדש**

אזור ייעודי (למשל תפריט צד או כפתור עליון) המאפשר:

1. **שמירת רשימה:** אפשרות לשמור את המצב הנוכחי תחת שם (למשל: "יום ראשון").  
2. **טעינת רשימה:** בחירה מתוך רשימת השגרות השמורות.  
3. **רשימה חדשה:** ניקוי הלוח ליצירת שגרה מאפס.

#### **ב. הכותרת (Header) \- עריכה שוטפת**

איזור קבוע בראש המסך הכולל:

1. **שם השגרה הפעילה** (למשל: "שגרת בוקר").  
2. **טופס הוספת פעילות:**  
   * שדה שם הפעילות.  
   * **כפתור הוספת תמונה:** פותח את גלריית המכשיר.  
   * **ממשק "חלון הצצה" (Preview & Position):** התמונה המקורית נשמרת, המשתמש גורר/מגדיל (Zoom/Pan) בתוך מסגרת ריבועית כדי לקבוע את התצוגה.  
   * **כפתור הוספה:** מוסיף את הפעילות לרשימה הנוכחית.

#### **ג. רשימת הפעילויות (The Stream)**

1. **כרטיסיות:** מציגות את החלק בתמונה שהוגדר ("Soft Crop").  
2. **גרירה (Reorder):** שינוי סדר הכרטיסים.  
3. **מחיקה:** הסרת כרטיס מהרשימה הנוכחית.

#### **ד. ביצוע משימה ומשוב**

1. **מיקוד (Focus):** הפעילות הראשונה שטרם בוצעה מודגשת.  
2. **סימון כבוצע:** לחיצה לסימון (V) ולחיצה חוזרת לביטול.  
3. **משוב (Feedback):** צליל עדין \+ חלונית (Modal) הצלחה למשך 2 שניות.

## **חלק ב': אפיון טכני (Technical Specification)**

**מיועד עבור:** מפתחים (Dev).

### **1\. ארכיטקטורה וניהול נתונים (Data Storage)**

* **Database:** שימוש ב-**IndexedDB**.  
* **Stores:** המערכת תשתמש בשני Object Stores:  
  1. schedules (מטא-דאטה על הרשימות).  
  2. activities (הפעילויות עצמן, כולל התמונות הכבדות).

### **2\. סכימת נתונים (Data Schema)**

#### **Store: schedules**

{  
  "id": "uuid-v4",  
  "name": "שגרת בוקר",  
  "createdAt": 1715605000000,  
  "lastModified": 1715605000000  
}

#### **Store: activities**

{  
  "id": "uuid-v4",  
  "scheduleId": "uuid-of-parent-schedule", // Foreign Key לשיוך לרשימה  
  "order": 1,  
  "title": "צחצוח שיניים",  
  "isDone": false,  
  "image": {  
    "blob": \[Blob Object\],  // הקובץ המקורי  
    "mimeType": "image/jpeg",  
    "position": {           // נתוני Soft Crop  
      "x": 10,  
      "y": \-20,  
      "scale": 1.5  
    }  
  }  
}

* **Indexes:** חובה ליצור אינדקס על שדה scheduleId בתוך ה-Store של activities כדי לאפשר שליפה מהירה של כל הפעילויות השייכות לרשימה ספציפית (getAllFromIndex).

### **3\. לוגיקת טיפול בתמונות (Soft Crop)**

* **HTML:** קונטיינר עם overflow: hidden ותמונה בפנים.  
* **JS:** הזרקת Blob URL ל-src, ושימוש ב-CSS Transform (translate, scale) לפי אובייקט ה-position השמור.

### **4\. אופטימיזציה (Performance)**

* **Lazy Loading:** בשליפת רשימה, יש לשקול טעינת ה-Blobs של התמונות רק כשהן נכנסות ל-Viewport (אם הרשימות ארוכות מאוד), או paging.  
* **Cleanup:** במחיקת רשימה (schedule), יש לבצע מחיקה "מדורגת" (Cascade Delete) של כל הפעילויות הקשורות אליה ב-Store של ה-activities כדי לא להשאיר תמונות יתומות שתופסות מקום.

### **5\. מחסנית טכנולוגית**

* **Framework:** אגנוסטי.  
* **Offline First:** עבודה מלאה ללא רשת.