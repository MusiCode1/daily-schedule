# תכונת חיתוך תמונות (Image Crop)

## סקירה כללית

הוספנו מערכת מלאה לניהול תמונות עם יכולת חיתוך (crop), זום והזזה. כל התמונות בפרויקט הן רבועות, והמערכת מאפשרת לבחור איזה חלק מהתמונה להציג.

## רכיבים חדשים

### 1. **ImageCropEditor** - עורך חיתוך תמונות
קומפוננטה אינטראקטיבית המאפשרת:
- ✂️ **גרירה (Drag)** - להזיז את מיקום התמונה
- 🔍 **זום (Zoom)** - להגדיל/להקטין את התמונה (גלגלת עכבר או כפתורים)
- 🔄 **איפוס** - לחזור למצב ברירת מחדל
- ✓ **אישור/ביטול** - לשמור או לבטל שינויים

**קובץ:** `src/lib/components/ImageCropEditor.svelte`

### 2. **ImageDisplay** - הצגת תמונות
קומפוננטה אחידה להצגת תמונות בכל הפרויקט.

**תכונות:**
- תמיכה בתמונות עם crop ובלי
- תמיכה לאחור (Backward compatibility) - מקבל גם `string` וגם `ImageData`
- גדלים מוגדרים מראש: `small`, `medium`, `large`, `full`
- אפשרות לפינות מעוגלות
- מצב טעינה אוטומטי

**קובץ:** `src/lib/components/ImageDisplay.svelte`

### 3. **ImageUploader** - שודרג
הקומפוננטה המקורית שודרגה:
- פתיחת עורך חיתוך אוטומטית אחרי בחירת תמונה
- אפשרות לערוך חיתוך של תמונות קיימות
- שמירת נתוני ה-crop יחד עם התמונה

**קובץ:** `src/lib/components/ImageUploader.svelte`

## מבני נתונים חדשים

### ImageCropData
```typescript
interface ImageCropData {
  x: number;      // מיקום X באחוזים (0-100)
  y: number;      // מיקום Y באחוזים (0-100)
  scale: number;  // זום (1 = מקורי, 2 = פי 2, וכו')
}
```

### ImageData
```typescript
interface ImageData {
  src: string;              // URL או idb:xxx
  crop?: ImageCropData;     // אופציונלי - אם אין, מציג את כל התמונה
}
```

**קובץ:** `src/lib/types.ts`

## שינויים בקומפוננטות קיימות

כל הקומפוננטות שהיו משתמשות ישירות ב-`<img use:dbImage>` שודרגו להשתמש ב-`ImageDisplay`:

### קומפוננטות מרכזיות:
- ✅ `TaskRow.svelte` - תמונות משימות
- ✅ `UserSelector.svelte` - אווטרים של משתמשים
- ✅ `ListSwitcher.svelte` - לוגו של רשימות
- ✅ `CelebrationModal.svelte` - תמונות במודאל חגיגה
- ✅ `AddModal.svelte` - תצוגה מקדימה של תמונות

### דפי הגדרות:
- ✅ `settings/users/+page.svelte` - ניהול אווטרים
- ✅ `settings/lists/+page.svelte` - ניהול לוגו רשימות
- ✅ `+page.svelte` - דף ראשי (אווטר המשתמש המחובר)

## שימוש

### הצגת תמונה
```svelte
<ImageDisplay 
  imageData={user.avatar}
  alt="שם המשתמש"
  size="medium"
  rounded={true}
/>
```

### העלאת תמונה עם crop
```svelte
<ImageUploader 
  imageData={currentImage}
  onchange={(data) => currentImage = data}
/>
```

## תמיכה לאחור

המערכת שומרת על תמיכה מלאה לאחור:
- `ImageDisplay` מקבל גם `string` (פורמט ישן) וגם `ImageData` (פורמט חדש)
- `ImageUploader` מחזיר `ImageData` אבל תומך בקבלת `string`
- התמונות הקיימות ימשיכו לעבוד ללא שינוי

## התנהגות ברירת מחדל

כאשר תמונה נבחרת לראשונה:
- **מיקום:** מרכז התמונה (x: 50%, y: 50%)
- **זום:** 1 (גודל מקורי)
- התמונה מוצגת בתוך מסגרת ריבועית

## יתרונות

1. 🎯 **חוויית משתמש משופרת** - אפשר לבחור את החלק הכי חשוב בתמונה
2. 🔄 **עקביות** - כל התמונות מוצגות בצורה אחידה
3. 📱 **מותאם למגע** - עובד גם עם Touch Events
4. ♿ **נגישות** - תמיכה מלאה בקוראי מסך
5. 🎨 **עיצוב מודרני** - אנימציות חלקות ומשוב ויזואלי ברור
6. 💾 **ביצועים** - התמונות נשמרות ב-IndexedDB ללא שינוי, רק נתוני ה-crop משתנים

## הערות טכניות

- נתוני ה-crop נשמרים במבנה ה-state הראשי
- התמונות עצמן לא משתנות (חוסך מקום)
- החישוב של ה-crop נעשה ב-CSS (transform + position)
- תמיכה מלאה ב-RTL

---

**תאריך יצירה:** ינואר 2026  
**גרסה:** 1.0
